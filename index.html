<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admazing — US Campaign Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #0D0D0D; --card: #1A1A1A; --card2: #141414;
      --purple: #7B42F6; --purple-lt: #9D6FF8;
      --white: #FFFFFF; --gray: #AAAAAA; --line: #2A2A2A;
      --green: #22C55E; --orange: #F59E0B; --red: #EF4444;
    }
    body { background: var(--bg); color: var(--white); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: 100vh; }
    .topbar { height: 4px; background: var(--purple); }
    header { display: flex; align-items: center; justify-content: space-between; padding: 14px 32px; border-bottom: 1px solid var(--line); flex-wrap: wrap; gap: 12px; }
    .logo-wrap img { height: 36px; display: block; }
    .header-title h1 { font-size: 18px; font-weight: 700; }
    .header-title p { font-size: 12px; color: var(--gray); margin-top: 2px; }
    .header-right { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    #last-updated { font-size: 12px; color: var(--gray); }
    .filters { display: flex; gap: 10px; padding: 14px 32px; background: var(--card2); border-bottom: 1px solid var(--line); flex-wrap: wrap; align-items: center; }
    .filter-label { font-size: 12px; color: var(--gray); }
    select { background: var(--card); color: var(--white); border: 1px solid var(--line); padding: 6px 12px; border-radius: 6px; font-size: 13px; cursor: pointer; }
    select:focus { outline: none; border-color: var(--purple); }
    select.year-select { border-color: var(--purple); color: var(--purple-lt); font-weight: 600; }
    main { padding: 24px 32px; max-width: 1400px; margin: 0 auto; }
    .kpis { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
    .kpi { background: var(--card); border-radius: 10px; padding: 18px 22px; border: 1px solid var(--line); }
    .kpi-val { font-size: 26px; font-weight: 700; margin-bottom: 4px; }
    .kpi-lbl { font-size: 11px; color: var(--gray); text-transform: uppercase; letter-spacing: 1px; }
    .kpi-sub { font-size: 11px; color: var(--purple-lt); margin-top: 4px; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .card { background: var(--card); border-radius: 10px; border: 1px solid var(--line); padding: 20px 24px; margin-bottom: 20px; }
    .card h2 { font-size: 11px; font-weight: 700; color: var(--purple); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 14px; }
    .exec-row { display: flex; align-items: center; gap: 12px; margin-bottom: 9px; }
    .exec-name { font-size: 13px; width: 160px; flex-shrink: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .exec-bar-wrap { flex: 1; background: var(--line); border-radius: 4px; height: 20px; overflow: hidden; }
    .exec-bar { height: 100%; background: var(--purple); border-radius: 4px; transition: width 0.6s ease; }
    .exec-rev { font-size: 12px; color: var(--gray); width: 90px; text-align: right; flex-shrink: 0; }
    .exec-cnt { font-size: 11px; color: var(--gray); width: 60px; text-align: right; flex-shrink: 0; }
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 12.5px; }
    thead tr { border-bottom: 1px solid var(--purple); }
    th { text-align: left; padding: 8px 12px; font-size: 11px; color: var(--gray); font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; white-space: nowrap; }
    tbody tr { border-bottom: 1px solid var(--line); transition: background 0.15s; }
    tbody tr:hover { background: rgba(123,66,246,0.06); }
    td { padding: 8px 12px; vertical-align: middle; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .badge-finished { background: rgba(34,197,94,0.15); color: var(--green); }
    .badge-cancelled { background: rgba(239,68,68,0.15); color: var(--red); }
    .badge-na { background: rgba(170,170,170,0.15); color: var(--gray); }
    .text-right { text-align: right; }
    .text-purple { color: var(--purple-lt); font-weight: 600; }
    .pagination { display: flex; align-items: center; justify-content: space-between; margin-top: 14px; font-size: 12px; color: var(--gray); }
    .page-btns { display: flex; gap: 8px; }
    .page-btn { background: var(--card2); color: var(--white); border: 1px solid var(--line); padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 12px; }
    .page-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .page-btn:not(:disabled):hover { border-color: var(--purple); }
    .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 300px; gap: 16px; }
    .spinner { width: 36px; height: 36px; border: 3px solid var(--line); border-top-color: var(--purple); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .chart-wrap { position: relative; height: 200px; }
    @media (max-width: 900px) {
      .kpis { grid-template-columns: repeat(2,1fr); }
      .grid-2 { grid-template-columns: 1fr; }
      main { padding: 16px; }
      header { padding: 14px 16px; }
      .filters { padding: 12px 16px; }
    }
  </style>
</head>
<body>
  <div class="topbar"></div>
  <header>
    <div class="logo-wrap">
      <img src="logo-white.png" alt="Admazing" />
    </div>
    <div class="header-title">
      <h1>US Campaign Dashboard</h1>
      <p>United States · Boltflow Operations · Updated Daily</p>
    </div>
    <div class="header-right">
      <span id="last-updated"></span>
    </div>
  </header>

  <div class="filters">
    <span class="filter-label">Year:</span>
    <select id="filter-year" class="year-select" onchange="applyFilters()"><option value="">All Years</option></select>
    <span class="filter-label">Executive:</span>
    <select id="filter-exec" onchange="applyFilters()"><option value="">All</option></select>
    <span class="filter-label">Quarter:</span>
    <select id="filter-quarter" onchange="applyFilters()">
      <option value="">All</option>
      <option>Q1</option><option>Q2</option><option>Q3</option><option>Q4</option>
    </select>
    <span class="filter-label">Advertiser:</span>
    <select id="filter-advertiser" onchange="applyFilters()"><option value="">All</option></select>
    <span class="filter-label">Status:</span>
    <select id="filter-status" onchange="applyFilters()">
      <option value="">All</option>
      <option>Finished</option><option>Cancelled</option>
    </select>
  </div>

  <main id="main-content">
    <div class="loading"><div class="spinner"></div><span style="color:var(--gray)">Loading campaign data...</span></div>
  </main>

  <script>
    let allRecords = [], filteredRecords = [], currentPage = 1;
    const PAGE_SIZE = 20;

    async function loadData() {
      try {
        const res = await fetch('data.json?t=' + Date.now());
        const data = await res.json();
        allRecords = data.records;

        const ts = new Date(data.generated_at);
        document.getElementById('last-updated').textContent = 'Data as of ' + ts.toLocaleDateString('en-US', {month:'short',day:'numeric',year:'numeric'});

        // Populate year filter
        const yearSel = document.getElementById('filter-year');
        yearSel.innerHTML = '<option value="">All Years</option>' + (data.years||[]).map(y => `<option ${y===2025?'selected':''}>${y}</option>`).join('');

        // Populate exec filter
        const execs = [...new Set(allRecords.map(r => r.exec))].sort();
        document.getElementById('filter-exec').innerHTML = '<option value="">All</option>' + execs.map(e => `<option>${e}</option>`).join('');

        // Populate advertiser filter
        const advertisers = [...new Set(allRecords.map(r => r.advertiser).filter(Boolean))].sort();
        document.getElementById('filter-advertiser').innerHTML = '<option value="">All</option>' + advertisers.map(a => `<option>${a}</option>`).join('');

        applyFilters();
      } catch(e) {
        document.getElementById('main-content').innerHTML = '<div class="loading"><span style="color:var(--red)">Failed to load data.</span></div>';
      }
    }

    function applyFilters() {
      const year = document.getElementById('filter-year').value;
      const exec = document.getElementById('filter-exec').value;
      const quarter = document.getElementById('filter-quarter').value;
      const advertiser = document.getElementById('filter-advertiser').value;
      const status = document.getElementById('filter-status').value;
      filteredRecords = allRecords.filter(r =>
        (!year || r.year == year) &&
        (!exec || r.exec === exec) &&
        (!quarter || r.quarter === quarter) &&
        (!advertiser || r.advertiser === advertiser) &&
        (!status || r.status === status)
      );
      currentPage = 1;
      render();
    }

    function render() {
      const records = filteredRecords;
      const totalRev = records.reduce((s,r) => s + r.revenue, 0);
      const finished = records.filter(r => r.status === 'Finished').length;

      const byExec = {};
      records.forEach(r => {
        if (!byExec[r.exec]) byExec[r.exec] = { count: 0, revenue: 0 };
        byExec[r.exec].count++;
        byExec[r.exec].revenue += r.revenue;
      });
      const execSorted = Object.entries(byExec).sort((a,b) => b[1].revenue - a[1].revenue);

      const byQ = { Q1:0, Q2:0, Q3:0, Q4:0 };
      records.forEach(r => { if (byQ[r.quarter] !== undefined) byQ[r.quarter] += r.revenue; });

      const byStatus = {};
      records.forEach(r => { byStatus[r.status] = (byStatus[r.status]||0) + 1; });

      document.getElementById('main-content').innerHTML = `
        <div class="kpis">
          <div class="kpi"><div class="kpi-val">${records.length}</div><div class="kpi-lbl">Total Projects</div><div class="kpi-sub">${finished} finished</div></div>
          <div class="kpi"><div class="kpi-val" style="color:var(--purple)">$${(totalRev/1e6).toFixed(1)}M</div><div class="kpi-lbl">Total Revenue</div><div class="kpi-sub">USD Gross</div></div>
          <div class="kpi"><div class="kpi-val">${Object.keys(byExec).length}</div><div class="kpi-lbl">Sales Executives</div><div class="kpi-sub">Active in period</div></div>
          <div class="kpi"><div class="kpi-val">$${records.length?(totalRev/records.length/1000).toFixed(0):0}K</div><div class="kpi-lbl">Avg Project Value</div><div class="kpi-sub">Per campaign</div></div>
        </div>
        <div class="grid-2">
          <div class="card"><h2>Revenue by Quarter</h2><div class="chart-wrap"><canvas id="qChart"></canvas></div></div>
          <div class="card"><h2>Project Status</h2><div class="chart-wrap"><canvas id="sChart"></canvas></div></div>
        </div>
        <div class="card"><h2>Revenue by Sales Executive</h2><div id="exec-bars"></div></div>
        <div class="card">
          <h2>All Projects</h2>
          <div class="table-wrap"><table>
            <thead><tr><th>Campaign</th><th>Executive</th><th>Advertiser</th><th>Year</th><th>Q</th><th>Start</th><th>End</th><th>Status</th><th class="text-right">Revenue</th></tr></thead>
            <tbody id="tbl"></tbody>
          </table></div>
          <div class="pagination">
            <span id="pg-info"></span>
            <div class="page-btns">
              <button class="page-btn" id="btn-p" onclick="changePage(-1)">← Prev</button>
              <button class="page-btn" id="btn-n" onclick="changePage(1)">Next →</button>
            </div>
          </div>
        </div>`;

      new Chart(document.getElementById('qChart'), {
        type: 'bar',
        data: { labels: ['Q1','Q2','Q3','Q4'], datasets: [{ data: Object.values(byQ), backgroundColor: ['#7B42F6','#9D6FF8','#7B42F6','#9D6FF8'], borderRadius: 6 }] },
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{ x:{ticks:{color:'#AAAAAA'},grid:{color:'#2A2A2A'}}, y:{ticks:{color:'#AAAAAA',callback:v=>'$'+(v/1e6).toFixed(1)+'M'},grid:{color:'#2A2A2A'}} } }
      });

      new Chart(document.getElementById('sChart'), {
        type: 'doughnut',
        data: { labels: Object.keys(byStatus), datasets: [{ data: Object.values(byStatus), backgroundColor: ['#22C55E','#EF4444','#F59E0B','#AAAAAA'], borderWidth:0 }] },
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{labels:{color:'#AAAAAA',font:{size:12}}}} }
      });

      const maxRev = execSorted[0]?.[1].revenue || 1;
      document.getElementById('exec-bars').innerHTML = execSorted.map(([n,d]) =>
        `<div class="exec-row"><div class="exec-name" title="${n}">${n}</div><div class="exec-bar-wrap"><div class="exec-bar" style="width:${(d.revenue/maxRev*100).toFixed(1)}%"></div></div><div class="exec-rev">$${(d.revenue/1e6).toFixed(1)}M</div><div class="exec-cnt">${d.count} proj</div></div>`
      ).join('');

      renderTable();
    }

    function renderTable() {
      const start = (currentPage-1) * PAGE_SIZE;
      const page = filteredRecords.slice(start, start + PAGE_SIZE);
      const total = filteredRecords.length;
      document.getElementById('tbl').innerHTML = page.map(r => {
        const bc = r.status==='Finished'?'badge-finished':r.status==='Cancelled'?'badge-cancelled':'badge-na';
        return `<tr><td>${r.name||'—'}</td><td>${r.exec}</td><td>${r.advertiser||'—'}</td><td>${r.year}</td><td>${r.quarter}</td><td>${r.start||'—'}</td><td>${r.end||'—'}</td><td><span class="badge ${bc}">${r.status}</span></td><td class="text-right text-purple">$${r.revenue.toLocaleString()}</td></tr>`;
      }).join('');
      document.getElementById('pg-info').textContent = `${start+1}–${Math.min(start+PAGE_SIZE,total)} of ${total}`;
      document.getElementById('btn-p').disabled = currentPage === 1;
      document.getElementById('btn-n').disabled = currentPage >= Math.ceil(total/PAGE_SIZE);
    }

    function changePage(d) { currentPage += d; renderTable(); }
    loadData();
  </script>
</body>
</html>
